# YOLO 安全帽检测系统 - 前端

基于 Vue 3 + TypeScript + Element Plus 的施工安全帽检测前端应用。

## 技术栈

- **Vue 3**：渐进式 JavaScript 框架（Composition API）
- **TypeScript**：类型安全的 JavaScript 超集
- **Element Plus 2.4.1**：Vue 3 UI 组件库
- **ECharts 5.4.3**：数据可视化图表库
- **Vue Router 4**：前端路由管理
- **Axios**：HTTP 客户端
- **Vite**：前端构建工具

## 环境要求

- **Node.js**: 16+
- **npm**: 8+

## 安装步骤

### 1. 安装依赖

```bash
npm install
```

### 2. 启动开发服务器

```bash
npm run dev
```

前端应用将在 `http://localhost:5173` 启动

### 3. 构建生产版本

```bash
npm run build
```

构建产物将输出到 `dist/` 目录

## 项目结构

```
web-front/
├── src/
│   ├── api/                 # API 接口定义
│   │   ├── auth.ts         # 认证接口
│   │   ├── detect.ts       # 检测接口
│   │   ├── model.ts        # 模型管理接口
│   │   ├── dataset.ts      # 数据集管理接口
│   │   ├── user.ts         # 用户管理接口
│   │   ├── statistics.ts   # 统计接口
│   │   └── index.ts        # Axios 配置
│   ├── components/         # 组件（已清理，暂无组件）
│   ├── layouts/            # 布局组件
│   │   └── MainLayout.vue  # 主布局（包含侧边栏）
│   ├── router/             # 路由配置
│   │   └── index.ts
│   ├── views/              # 页面视图
│   │   ├── Login.vue       # 登录页
│   │   ├── Register.vue    # 注册页
│   │   ├── Home.vue        # 首页
│   │   ├── DetectImage.vue # 图片检测
│   │   ├── DetectVideo.vue # 视频检测
│   │   ├── DetectRealtime.vue # 实时检测
│   │   ├── ModelManager.vue  # 模型管理
│   │   ├── ModelInfo.vue     # 模型详情
│   │   ├── DatasetManager.vue # 数据集管理
│   │   ├── UserManager.vue   # 用户管理
│   │   └── Console.vue        # 数据统计
│   ├── App.vue             # 根组件
│   ├── main.ts             # 入口文件
│   └── style.css           # 全局样式
├── package.json
├── vite.config.ts          # Vite 配置（包含 API 代理）
└── README.md
```

## 配置说明

### API 代理配置

在 `vite.config.ts` 中配置了 API 代理：

```typescript
server: {
  proxy: {
    '/api': {
      target: 'http://localhost:5000',
      changeOrigin: true
    }
  }
}
```

所有 `/api` 开头的请求会被代理到 `http://localhost:5000`

### 环境变量

可以创建 `.env` 文件配置环境变量：

```env
VITE_API_BASE_URL=http://localhost:5000
```

## 主要功能

### 用户认证
- 用户登录（JWT Token 认证）
- 用户注册
- 自动保存 Token 到 localStorage
- 路由守卫（未登录用户重定向到登录页）

### 安全帽检测
- **图片检测**：
  - 支持上传图片文件
  - 选择已发布的模型
  - 动态调整置信度阈值（0-100%）
  - 显示检测结果和统计信息
  
- **视频检测**：
  - 支持上传视频文件
  - 选择已发布的模型
  - 动态调整置信度阈值和检测 FPS
  - 显示检测结果视频和关键帧（仅显示有检测结果的帧）
  - 显示详细统计信息（原始关键帧、检测帧数、总检测数等）
  - 工具提示说明每个统计项的含义
  
- **实时检测**：
  - 基于摄像头实时检测
  - 选择已发布的模型
  - 动态调整置信度阈值和检测 FPS
  - 开始检测时自动清空统计数据
  - 停止检测时自动保存统计数据到数据库

### 模型管理（管理员）
- **模型列表**：查看所有模型，支持搜索和筛选
- **创建模型**：创建自定义模型，配置训练参数（包括训练设备 CPU/GPU）
- **编辑模型**：编辑模型信息（名称、类型、描述、训练参数）
- **导入模型**：导入已有的 `.pt` 模型文件（默认类型为"通用模型"）
- **训练模型**：使用保存的训练参数训练模型
- **发布/取消发布**：发布模型后才能在检测页面使用
- **查看详情**：查看模型基本信息、性能指标、训练数据
- **删除模型**：删除不需要的模型

### 数据集管理（管理员）
- **数据集列表**：查看所有数据集，支持搜索
- **创建数据集**：创建新的数据集
- **上传数据集**：上传 ZIP 格式的数据集文件
- **查看详情**：查看数据集详细信息
- **删除数据集**：删除不需要的数据集
- **验证状态**：显示数据集验证状态和失败原因

### 用户管理（管理员）
- **用户列表**：查看所有用户
- **创建用户**：创建新用户账号
- **编辑用户**：修改用户信息
- **删除用户**：删除用户账号

### 数据统计（管理员）
- **检测统计**：总检测次数、佩戴/未佩戴统计、检测率
- **趋势分析**：检测趋势图表（折线图）
- **分布统计**：检测结果分布（饼图）
- **每日统计**：每日检测数量统计（分组柱状图，按图片、视频、实时检测三种类型分组）
- **历史记录**：查看历史检测记录

## 开发说明

### 开发模式

开发服务器支持热重载（HMR），修改代码后自动刷新。

### API 调用

所有 API 调用都通过 `src/api/` 目录下的 TypeScript 接口文件定义：

- `auth.ts` - 认证相关 API
- `detect.ts` - 检测相关 API
- `model.ts` - 模型管理 API
- `dataset.ts` - 数据集管理 API
- `user.ts` - 用户管理 API
- `statistics.ts` - 统计 API

### 路由配置

路由配置在 `src/router/index.ts` 中：

- 公开路由：`/login`、`/register`
- 需要登录的路由：所有其他路由
- 需要管理员权限的路由：模型管理、数据集管理、用户管理、数据统计

### 状态管理

使用 Vue 3 的 `ref` 和 `reactive` 进行状态管理，Token 存储在 `localStorage` 中。

### UI 组件

使用 Element Plus 组件库：
- `el-button` - 按钮
- `el-input` - 输入框
- `el-table` - 表格
- `el-dialog` - 对话框
- `el-form` - 表单
- `el-upload` - 文件上传
- `el-slider` - 滑块
- `el-tag` - 标签
- `el-tooltip` - 工具提示
- 等等

### 图表组件

使用 ECharts 进行数据可视化：
- 折线图：检测趋势
- 饼图：检测结果分布
- 分组柱状图：每日检测统计（按类型分组）

## 注意事项

1. **API 代理**：开发模式下，所有 `/api` 请求会被代理到后端服务器（`http://localhost:5000`）
2. **Token 管理**：Token 存储在 `localStorage` 中，页面刷新后自动恢复登录状态
3. **权限控制**：使用路由守卫和 API 拦截器实现权限控制
4. **错误处理**：统一的错误处理机制，友好的中文错误提示
5. **响应式设计**：支持不同屏幕尺寸的响应式布局
6. **浏览器兼容性**：建议使用 Chrome、Firefox 或 Edge 浏览器

## 故障排除

### 1. 无法连接到后端 API

**原因**：后端服务未启动或代理配置错误

**解决方案**：
- 确保后端服务正在运行（`http://localhost:5000`）
- 检查 `vite.config.ts` 中的代理配置
- 检查浏览器控制台的网络请求

### 2. 登录后 Token 丢失

**原因**：localStorage 被清除或浏览器设置问题

**解决方案**：
- 检查浏览器是否禁用了 localStorage
- 检查是否有其他脚本清除了 localStorage
- 重新登录

### 3. ECharts 图表不显示

**原因**：DOM 元素未正确初始化或数据为空

**解决方案**：
- 确保图表容器元素已正确渲染
- 使用 `nextTick` 和 `requestAnimationFrame` 确保 DOM 就绪
- 检查数据是否正确加载

### 4. 视频预览无法播放

**原因**：视频编码格式不兼容或 CORS 问题

**解决方案**：
- 确保后端返回的视频是 H.264 编码
- 检查后端 CORS 配置
- 检查视频 URL 是否正确

## 性能优化

1. **代码分割**：使用动态导入实现路由级别的代码分割
2. **图片优化**：使用适当的图片格式和大小
3. **懒加载**：图表组件使用懒加载
4. **缓存策略**：合理使用浏览器缓存

## 许可证

本项目仅供学习和研究使用。
